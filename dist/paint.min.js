!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("paint",[],e):"object"==typeof exports?exports.paint=e():t.paint=e()}(window,function(){return o={},i.m=n=[function(t,e,n){var o=n(1);"string"==typeof o&&(o=[[t.i,o,""]]);var i={insert:"head",singleton:!1};n(3)(o,i);o.locals&&(t.exports=o.locals)},function(t,e,n){(t.exports=n(2)(!1)).push([t.i,"/**\n * Created Date: 2017-10-16 09:27:09\n * Author: inu1255\n * E-Mail: 929909260@qq.com\n */\n.input-style {\n  width: 100%;\n  height: 38px;\n  padding: 6px 12px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  border-radius: 3px;\n  -webkit-transition: all 0.5s;\n  -o-transition: all 0.5s;\n  transition: all 0.5s;\n}\n.input-style:focus {\n  border-color: #1F90E6;\n  -webkit-box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n          box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n}\n.textarea-style {\n  line-height: 1.42857143;\n  width: 100%;\n  padding: 6px 12px;\n  border-radius: 3px;\n  -webkit-transition: all 0.5s;\n  -o-transition: all 0.5s;\n  transition: all 0.5s;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n}\n.textarea-style:focus {\n  border-color: #1F90E6;\n  -webkit-box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n          box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n}\n.select-style {\n  width: 100%;\n  height: 33px;\n  padding: 5px 12px;\n  background-color: #fff;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  border-radius: 3px;\n  -webkit-transition: all 0.5s;\n  -o-transition: all 0.5s;\n  transition: all 0.5s;\n}\n.select-style:focus {\n  border-color: #1F90E6;\n  -webkit-box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n          box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n}\n.hide {\n  opacity: 0;\n  pointer-events: none;\n}\n.show {\n  opacity: 1;\n  pointer-events: auto;\n}\n.painter-menu {\n  position: absolute;\n  background: #eee;\n  border: 1px solid #ccc;\n  max-width: 50%;\n}\n.painter-menu > .painter-menu__btn {\n  float: left;\n  margin: 5px 7px;\n  padding: 2px 5px;\n  color: #fff;\n  background: #1DA57A;\n  cursor: pointer;\n}\n.painter-menu > .painter-menu__btn:hover {\n  background: #048c61;\n}\n.painter-menu > .painter-menu__btn.selected {\n  background: #048c61;\n}\n.painter-menu > .painter-menu__btn:active,\n.painter-menu > .painter-menu__btn.active {\n  background: #007348;\n  -webkit-box-shadow: inset 0 0 20px 0 rgba(0, 0, 0, 0.1), 0 1px 0 rgba(0, 0, 0, 0.2);\n          box-shadow: inset 0 0 20px 0 rgba(0, 0, 0, 0.1), 0 1px 0 rgba(0, 0, 0, 0.2);\n}\n.painter-menu > .painter-menu__btn:disabled {\n  background: #36be93;\n  opacity: 0.65;\n  cursor: not-allowed;\n}\n.painter-menu > .painter-menu__move {\n  margin: 5px 7px;\n  width: 24px;\n  height: 24px;\n  float: right;\n  border: 1px solid #ccc;\n  cursor: move;\n}\n.painter-canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n.painter-canvas > * {\n  pointer-events: none;\n}\n.painter-canvas.eraser > * {\n  pointer-events: visiblestroke;\n}\n.painter-canvas.disable {\n  pointer-events: none;\n}\n.painter-canvas.disable > * {\n  pointer-events: none;\n}\n.painter-canvas__item {\n  position: absolute;\n}\n",""])},function(t,e,n){"use strict";t.exports=function(n){var s=[];return s.toString=function(){return this.map(function(t){var e=function(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var i=function(t){var e=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(n," */")}(o),r=o.sources.map(function(t){return"/*# sourceURL=".concat(o.sourceRoot).concat(t," */")});return[n].concat(r).concat([i]).join("\n")}return[n].join("\n")}(t,n);return t[2]?"@media ".concat(t[2],"{").concat(e,"}"):e}).join("")},s.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];null!=i&&(n[i]=!0)}for(var r=0;r<t.length;r++){var a=t[r];null!=a[0]&&n[a[0]]||(e&&!a[2]?a[2]=e:e&&(a[2]="(".concat(a[2],") and (").concat(e,")")),s.push(a))}},s}},function(t,e,i){"use strict";var n,o,f={},r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},a=(o={},function(t){if(void 0===o[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}o[t]=e}return o[t]});function l(t,e){for(var n=[],o={},i=0;i<t.length;i++){var r=t[i],a=e.base?r[0]+e.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};o[a]?o[a].parts.push(s):n.push(o[a]={id:a,parts:[s]})}return n}function h(t,e){for(var n=0;n<t.length;n++){var o=t[n],i=f[o.id],r=0;if(i){for(i.refs++;r<i.parts.length;r++)i.parts[r](o.parts[r]);for(;r<o.parts.length;r++)i.parts.push(y(o.parts[r],e))}else{for(var a=[];r<o.parts.length;r++)a.push(y(o.parts[r],e));f[o.id]={id:o.id,refs:1,parts:a}}}}function s(e){var n=document.createElement("style");if(void 0===e.attributes.nonce){var t=i.nc;t&&(e.attributes.nonce=t)}if(Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t])}),"function"==typeof e.insert)e.insert(n);else{var o=a(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}return n}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function p(t,e,n,o){var i=n?"":o.css;if(t.styleSheet)t.styleSheet.cssText=u(e,i);else{var r=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}var d=null,v=0;function y(e,t){var n,o,i;if(t.singleton){var r=v++;n=d=d||s(t),o=p.bind(null,n,r,!1),i=p.bind(null,n,r,!0)}else n=s(t),o=function(t,e,n){var o=n.css,i=n.media,r=n.sourceMap;if(i&&t.setAttribute("media",i),r&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}.bind(null,n,t),i=function(){!function(t){if(null===t.parentNode)return;t.parentNode.removeChild(t)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else i()}}t.exports=function(t,c){(c=c||{}).attributes="object"==typeof c.attributes?c.attributes:{},c.singleton||"boolean"==typeof c.singleton||(c.singleton=r());var u=l(t,c);return h(u,c),function(t){for(var e=[],n=0;n<u.length;n++){var o=u[n],i=f[o.id];i&&(i.refs--,e.push(i))}t&&h(l(t,c),c);for(var r=0;r<e.length;r++){var a=e[r];if(0===a.refs){for(var s=0;s<a.parts.length;s++)a.parts[s]();delete f[a.id]}}}}},function(t,e,n){"use strict";n.r(e);n(0);var y=function(){var r={};this.addEventListener=function(t,e){return void 0===r[t]&&(r[t]=[]),"function"==typeof e&&r[t].push(e),this},this.dispatchEvent=function(t,e){var n=r[t];if(n instanceof Array)for(var o=0,i=n.length;o<i;o+=1)"function"==typeof n[o]&&n[o](e);return this},this.removeEventListener=function(t,e){var n=r[t];if("string"==typeof t&&n instanceof Array)if("function"==typeof e){for(var o=0,i=n.length;o<i;o+=1)if(n[o]===e){r[t].splice(o,1);break}}else void 0===e&&delete r[t];return this}};var s=new function(){this.filter=function(t){if(0,!Array.isArray(t))return console.error("参数必须是数组：",t),t;for(var e=JSON.parse(JSON.stringify(t)),n=1;n<e.length;n+=2)if(!(n<3)){var o=e[n-3],i=e[n-2],r=e[n-1],a=e[n];if(o!==r||i!==a){if(!(n<5)){o=e[n-5],i=e[n-4],r=e[n-3],a=e[n-2];var s=e[n-1],c=e[n],u=s-r?(c-a)/(s-r):0,f=r-o?(a-i)/(r-o):0;if(Math.abs(u-f)<=.1){e.splice(n-3,2);n-=2}else;}}else{e.splice(n-1,2);n-=2}}return e}};function o(i,r){var a=[];this.begin=function(t,e){a.push(t),a.push(e)},this.move=function(t,e,n,o){a.push(n),a.push(o),i(a)},this.end=function(t,e,n,o){a.push(n),a.push(o),a=s.filter(a),r(a)}}o.moveBegin=!0,o.outEnd=!0,o.render=function(t,e){if(t instanceof Array&&0<t.length){var n=e.ctx;n.beginPath(),n.moveTo(t[0],t[1]);for(var o=2;o<t.length;o+=2)n.lineTo(t[o],t[o+1]);n.stroke()}},o.renderSvg=function(t,e){if(t instanceof Array&&0<t.length){for(var n="",o=0;o<t.length;o++){o%2==0&&(n+=0==o?"M":"L"),n+=t[o]+" "}return'<path d="'.concat(n,'" style="').concat(e.getStyle(),'"/>')}};var i=o;function r(i,r){this.move=function(t,e,n,o){i([t,e,n,o])},this.end=function(t,e,n,o){r([t,e,n,o])}}r.moveBegin=!0,r.render=function(t,e){if(t&&4===t.length){var n=e.ctx;n.beginPath(),n.moveTo(t[0],t[1]),n.lineTo(t[2],t[3]),n.stroke()}},r.renderSvg=function(t,e){return t&&4===t.length?'<line x1="'.concat(t[0],'" y1="').concat(t[1],'" x2="').concat(t[2],'" y2="').concat(t[3],'" style="').concat(e.getStyle(),'"/>'):""};var a=r;function c(i,r){this.move=function(t,e,n,o){i([t,e,n,o])},this.end=function(t,e,n,o){r([t,e,n,o])}}c.moveBegin=!0,c.render=function(t,e){if(t&&4===t.length){var n=e.ctx,o=(t[0]+t[2])/2,i=(t[1]+t[3])/2,r=(t[2]-t[0])/2,a=(t[3]-t[1])/2,s=a<r?r:a,c=r/s,u=a/s;n.scale(c,u),n.beginPath(),n.arc(o/c,i/u,s,0,2*Math.PI,!1),n.closePath(),n.stroke()}},c.renderSvg=function(t,e){if(t&&4===t.length){var n=(t[0]+t[2])/2,o=(t[1]+t[3])/2,i=Math.abs((t[2]-t[0])/2),r=Math.abs((t[3]-t[1])/2);return'<ellipse cx="'.concat(n,'" cy="').concat(o,'" rx="').concat(i,'" ry="').concat(r,'" style="').concat(e.getStyle(),'"/>')}return""};var u=c;function f(i,r){this.move=function(t,e,n,o){i([t,e,n,o])},this.end=function(t,e,n,o){r([t,e,n,o])}}f.moveBegin=!0,f.render=function(t,e){return console.error("暂未实现画canvas的圆形")},f.renderSvg=function(t,e){if(t&&4===t.length){var n=t[0],o=t[1],i=Math.pow(Math.abs(t[2]-t[0]),2),r=Math.pow(Math.abs(t[3]-t[1]),2),a=Math.sqrt(i+r);return'<circle cx="'.concat(n,'" cy="').concat(o,'" r="').concat(a,'" style="').concat(e.getStyle(),'"/>')}return""};var l=f;function h(i,r){this.move=function(t,e,n,o){i([t,e,n,o])},this.end=function(t,e,n,o){r([t,e,n,o])}}h.moveBegin=!0,h.render=function(t,e){if(t&&4===t.length){var n=e.ctx;n.beginPath(),n.moveTo(t[0],t[1]),n.lineTo(t[2],t[1]),n.lineTo(t[2],t[3]),n.lineTo(t[0],t[3]),n.lineTo(t[0],t[1]),n.stroke()}},h.renderSvg=function(t,e){if(t&&4===t.length){var n=Math.min(t[0],t[2]),o=Math.min(t[1],t[3]),i=Math.abs(t[2]-t[0]),r=Math.abs(t[3]-t[1]);return'<rect x="'.concat(n,'" y="').concat(o,'" width="').concat(i,'" height="').concat(r,'" style="').concat(e.getStyle(),'"/>')}};var p=h;function d(r,t,a){var s,c,u;this.close=this.begin=function(){if(u&&(t(u),u=null),c)try{c.removeChild(s)}catch(t){}},this.end=function(t,e,n,o){var i=this;u=[t,e],(s=document.createElement("textarea")).addEventListener("keyup",function(t){t.ctrlKey&&13==t.keyCode?i.close():(u[2]=s.value,r(u))}),c=a(s,n,o),s.focus()}}d.render=function(t,e){if(t&&4<=t.length){var n=e.ctx;n.font=d.font;var o=t[2]||"",i=t[0],r=t[1],a=parseInt(d.font);o.split("\n").forEach(function(t,e){n.fillText(t,i,r+e*a)})}},d.renderSvg=function(t,e){if(t&&3===t.length){var n=t[0],o=t[1],i=parseInt(e.penStyle["font-size"]),r="",a=!0,s=!1,c=void 0;try{for(var u,f=(t[2]||"").split("\n")[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var l=u.value;r+='<text x="'.concat(n,'" y="').concat(o,'" style="').concat(e.getStyle(),'">').concat(l,"</text>"),o+=i}}catch(t){s=!0,c=t}finally{try{a||null==f.return||f.return()}finally{if(s)throw c}}return"<g>".concat(r,"</g>")}return""};var v=d;function g(t,e){return e=e||0,t.previousElementSibling?g(t.previousElementSibling,e+1):e+""}function m(i,r,t,e){if("svg"==e.canvas.tagName){var a=[],n=function(t){t.target!=e.canvas&&1==t.which&&(a.push(g(t.target)),i(a))},o=function(t){t.target!=e.canvas&&(a.push(g(t.target)),i(a))};e.canvas.addEventListener("mousemove",n),e.canvas.addEventListener("click",o),this.end=function(t,e,n,o,i){r(0<a.length?a:void 0)},this.unmount=function(){e.canvas.removeEventListener("mousemove",n),e.canvas.removeEventListener("click",o)}}else{var s=[];this.begin=function(t,e,n,o){s.push(t),s.push(e)},this.move=function(t,e,n,o){s.push(n),s.push(o),i(s)},this.end=function(t,e,n,o){s.push(n),s.push(o),r(s)}}}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}m.render=function(t,e){if(t instanceof Array&&0<t.length)for(var n=e.ctx,o=0;o<t.length;o+=2)n.save(),n.beginPath(),n.arc(t[o],t[o+1],5,0,2*Math.PI),n.clip(),n.clearRect(0,0,n.canvas.width,n.canvas.height),n.restore()},m.renderSvg=function(t,n){t instanceof Array&&0<t.length&&t.forEach(function(t){var e=n.canvas.childNodes[t];e&&(e.style.display="none")})};var x={defaultPen:i,linePen:a,ellipsePen:u,circlePen:l,rectPen:p,textPen:v,eraser:m};var w={get:function(t){return x[t]||i},key:function(t){if("object"==b(t)&&(t=t.constuctor),"function"==typeof t&&"function"==typeof t.render)for(var e in x){if(t==x[e])return e}},set:function(t,e){return"function"==typeof e&&"function"==typeof e.render&&(x[t]=e,!0)},keys:function(){var t=[];for(var e in x)t.push(e);return t}};var E=function(t){var e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset-document.documentElement.clientTop,left:e.left+window.pageXOffset-document.documentElement.clientLeft,right:e.right,bottom:e.bottom}};function S(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var k=w.get();Object.assign||(Object.assign=function(t,e){for(var n in e){var o=e[n];t[n]=o}return t});var C=function(){function v(t,o){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,v),y.call(this);var e,r=this.canvas=this.createCanvas(),a=this.dom=t;t instanceof HTMLImageElement&&(a=document.createElement("div"),Object.assign(a.style,t.style),t.parentElement.insertBefore(a,t),t.parentElement.removeChild(t),a.appendChild(t)),o=this.config=Object.assign(this.defaultConfig(),o),this.init();var s=!1;function c(){return e}this.outPoint=!1,this.setData=function(t){void 0!==t&&(i.config.penData=t,i.update())};function n(t){var e=i.normalizeEvent(t,o),n=c();s=s||{x:e.offsetX,y:e.offsetY},"function"==typeof n.begin&&n.begin(s.x,s.y),"function"==typeof t.preventDefault&&t.preventDefault(),"function"==typeof t.stopPropagation&&t.stopPropagation()}function u(t){var e=i.normalizeEvent(t,o),n=c();!s&&1==t.which&&o.penClass.moveBegin&&(s={x:e.offsetX,y:e.offsetY,moveBegin:!0}),s&&("function"==typeof n.move&&n.move(s.x,s.y,e.offsetX,e.offsetY),"function"==typeof t.preventDefault&&t.preventDefault(),"function"==typeof t.stopPropagation&&t.stopPropagation())}function f(t){var e=i.normalizeEvent(t,o);l({x:e.offsetX,y:e.offsetY}),"function"==typeof t.preventDefault&&t.preventDefault(),"function"==typeof t.stopPropagation&&t.stopPropagation()}var l=this.end=function(t,e){var n;"setPen"==e&&"function"==typeof(n=c()).close&&n.close();s&&("function"==typeof(n=c()).end&&n.end(s.x,s.y,t.x,t.y,e),s=!1)};r.addEventListener("mousedown",n),r.addEventListener("mousemove",u),r.addEventListener("mouseup",f),r.addEventListener("touchstart",n),r.addEventListener("touchmove",u),r.addEventListener("touchend",f),r.addEventListener("mouseover",function(t){o.penClass.outEnd||i.outPoint&&1!=t.which&&l(i.outPoint,"mouseover"),i.outPoint=!1}),r.addEventListener("mouseout",function(t){var e=i.normalizeEvent(t,o);i.outPoint={x:e.offsetX,y:e.offsetY},t.toElement&&t.toElement.parentElement==r||(o.penClass.outEnd?l(i.outPoint,"mouseout"):1==t.which&&u(e))});function h(t,e,n){return t&&(t.className="painter-canvas__item",null!=e&&(t.style.left=i.warpData(e,r)+"px"),null!=n&&(t.style.top=i.warpData(n,r,1)+"px"),a.appendChild(t)),a}var p=this.createNewPen=function(){e&&"function"==typeof e.unmount&&e.unmount(),e=new o.penClass(i.setData,d,h,i)},d=function(t){i.dispatchEvent("success",t),p(),void 0!==t&&(o.history.push({key:w.key(o.penClass),data:t,style:i.getStyle()}),o.penData=void 0,o.redo.length=0,i.update())};p(),a.appendChild(r),"static"===getComputedStyle(a).position&&(a.style.position="relative"),this.resize()}return function(t,e,n){e&&S(t.prototype,e),n&&S(t,n)}(v,[{key:"defaultConfig",value:function(){return{history:[],redo:[],penClass:k}}},{key:"warpData",value:function(t,e){var n=this.config;if(t instanceof Array){var o=[];for(e=0;e<t.length;e++){var i=t[e];o.push(this.warpData(i,e))}return o}return"number"==typeof t?(1&e?n.height:n.width)*t/1e4:t}},{key:"normalizeEvent",value:function(t,e){if(t.normalized)return t;var n,o;if(t instanceof TouchEvent){var i=E(t.target);n=(t.changedTouches[0]||t.touches[0]).pageX-i.left,o=(t.changedTouches[0]||t.touches[0]).pageY-i.top}else n=t.offsetX,o=t.offsetY;return{offsetX:n=Math.floor(n/e.width*1e4),offsetY:o=Math.floor(o/e.height*1e4),normalized:!0}}},{key:"setPen",value:function(t){this.end(this.outPoint,"setPen"),"string"==typeof t&&(this._prevPenClass&&this.canvas.classList.remove(this._prevPenClass),this._prevPenClass=t,this.canvas.classList.add(t)),void 0===t&&(t=k);var e=w.get(t);e?(this.config.penClass!=e&&(this.config.penClass=e,this.config.penData=void 0),this.createNewPen()):console.log("不能识别的画笔",t)}},{key:"stringify",value:function(){return JSON.stringify(this.config.history)}},{key:"parse",value:function(t){if("string"==typeof t)this.config.history=JSON.parse(t);else{if(!(t instanceof Array))return;this.config.history=t}this.update(!0)}},{key:"undo",value:function(t){if(0<this.config.history.length){if(t)return!0;this.config.redo.push(this.config.history.pop()),this.update(!0)}}},{key:"redo",value:function(t){if(0<this.config.redo.length){if(t)return!0;this.config.history.push(this.config.redo.pop()),this.update()}}},{key:"getCanvas",value:function(){return this.canvas}},{key:"resize",value:function(){var t=!1,e=this.dom,n=this.config;return e.offsetWidth!=n.width&&(t=!0,n.width=e.scrollWidth||e.offsetWidth),e.offsetHeight!=n.height&&(t=!0,n.height=e.scrollHeight||e.offsetHeight),t}},{key:"offset",value:function(){return E(this.canvas)}},{key:"disable",value:function(){this.canvas.classList.add("disable")}},{key:"enable",value:function(){this.canvas.classList.remove("disable")}},{key:"scale",value:function(t){this.canvas.parentElement.style.transformOrigin="50% 0 0",this.canvas.parentElement.style.transform="scale(".concat(t,")"),this.update()}},{key:"init",value:function(){}},{key:"createCanvas",value:function(){}},{key:"getStyle",value:function(){}},{key:"update",value:function(){}}]),v}();function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function L(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var D=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),L(this,O(t).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(t,C),function(t,e,n){e&&_(t.prototype,e),n&&_(t,n)}(t,[{key:"createCanvas",value:function(){var t=document.createElement("div");return t.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="painter-canvas"></svg>',t.childNodes[0]}},{key:"init",value:function(){this.current_indx=0,this.penStyle={fill:"rgba(0,0,0,0)",stroke:"red","font-size":"30px","stroke-width":2,"letter-spacing":"0px"}}},{key:"getStyle",value:function(){var t="";for(var e in this.penStyle){t+=e+":"+this.penStyle[e]+";"}return t}},{key:"setColor",value:function(t){return this.penStyle.stroke=t}},{key:"setStyle",value:function(t){var n=this;"object"===P(t)?Object.assign(this.penStyle,t):"string"==typeof t&&t.split(";").forEach(function(t){var e=t.split(":");1<e.length&&(n.penStyle[e[0].trim()]=e[1].trim())})}},{key:"append",value:function(t,e){if(e){var o;try{o=document.createElementNS("http://www.w3.org/2000/svg",/<(\w+)/.exec(e)[1]),e.replace(/\s+(\w+)=['"]([^'"]+)['"]/g,function(t,e,n){o.setAttribute(e,n)}),e.replace(/>([\s\S]+)</,function(t,e){o.innerHTML=e}),this.currentDom?t.insertBefore(o,this.currentDom):t.appendChild(o)}catch(t){console.log(t)}return o}}},{key:"update",value:function(t){this.resize();var e=this.canvas,n=this.config;if(this.dispatchEvent("beforeupdate"),t){for(this.current_indx=0;e.hasChildNodes();)e.removeChild(e.firstChild);this.currentDom=!1}if(void 0!==n.penData){var o=n.penClass.renderSvg(this.warpData(n.penData),this);this.currentDom&&(e.removeChild(this.currentDom),this.currentDom=!1),this.currentDom=this.append(e,o)}else this.currentDom&&(e.removeChild(this.currentDom),this.currentDom=!1);for(;this.current_indx<n.history.length;this.current_indx++){var i=n.history[this.current_indx];this.append(e,this.paintItem(i,this.current_indx))}this.dispatchEvent("update")}},{key:"resize",value:function(){var t=!1,e=this.canvas,n=this.config,o=this.dom,i=o.scrollWidth||o.offsetWidth;i!=Number((e.style.width+"").replace("px",""))&&(t=!0,n.width=i,e.style.width=i+"px");var r=o.scrollHeight||o.offsetHeight;return r!=Number((e.style.height+"").replace("px",""))&&(t=!0,n.height=r,e.style.height=r+"px"),t}},{key:"paintItem",value:function(t){if("object"==P(t)){var e=w.get(t.key),n="";if(e&&e.renderSvg){var o=this.getStyle();this.setStyle(t.style),n=e.renderSvg(this.warpData(t.data),this),this.setStyle(o)}return n}}},{key:"toSvg",value:function(){var t=this.canvas.cloneNode();t.innerHTML=this.canvas.innerHTML;for(var e=t.childNodes.length-1;0<=e;e--){var n=t.childNodes[e];"none"===n.style.display&&t.removeChild(n)}return t.removeAttribute("class"),t.removeAttribute("style"),t.outerHTML}}]),t}();function M(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function T(t,e){return!e||"object"!==R(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function N(t,e,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var X=["fillStyle","filter","font","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"];CanvasRenderingContext2D.prototype.getStyle=function(){var e=this,n={};return X.forEach(function(t){e[t]!=e.initStyle[t]&&(n[t]=e[t])}),n},CanvasRenderingContext2D.prototype.setStyle=function(e){var n=this;return"object"!=R(e)||X.forEach(function(t){null!=e[t]?n[t]=e[t]:n.initStyle[t]&&(n[t]=n.initStyle[t])}),this};var Y=function(){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),T(this,B(n).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(n,C),function(t,e,n){e&&M(t.prototype,e),n&&M(t,n)}(n,[{key:"defaultConfig",value:function(){return Object.assign({background:"",initStyle:{fillStyle:"red",strokeStyle:"red"}},N(B(n.prototype),"defaultConfig",this).call(this))}},{key:"init",value:function(){var t=this.ctx=this.canvas.getContext("2d");t.initStyle={},t.setStyle(this.config.initStyle),t.initStyle=t.getStyle()}},{key:"createCanvas",value:function(){var t=document.createElement("canvas");return t.className="painter-canvas",t}},{key:"getStyle",value:function(){return this.ctx.getStyle()}},{key:"update",value:function(){var e=this;this.resize();var t=this.canvas,n=this.ctx,o=this.config;n.clearRect(0,0,o.width,o.height),this.dispatchEvent("beforeupdate",n),o.background&&n.drawImage(o.background,0,0,o.width,o.height),o.history.forEach(function(t){e.paintItem(n,t,o)}),void 0!==o.penData&&(n.save(),o.penClass.render(this.warpData(o.penData,t),this),n.restore()),this.dispatchEvent("update",n)}},{key:"resize",value:function(){if(N(B(n.prototype),"resize",this).call(this)){var t=this.canvas,e=this.config;t.width=e.width,t.height=e.height,this.ctx.setStyle({})}}},{key:"paintItem",value:function(t,e){if("object"==R(e)){var n=w.get(e.key);n&&(t.save(),t.setStyle(e.style),n.render(this.warpData(e.data),this),t.restore())}}},{key:"getCtx",value:function(){return this.ctx}},{key:"setColor",value:function(t){this.ctx.fillStyle=t,this.ctx.strokeStyle=t}},{key:"toDataURL",value:function(){return this.canvas.toDataURL()}}]),n}();var z=function(t,i){var r=this;y.call(this),i=i||t,this.state={end:E(i)},this.setBegin=function(t,e){this.state.begin={left:t,top:e}},this.warpEvent=function(t){return t.preventDefault(),t instanceof TouchEvent&&("touchend"===t.type?(t.pageX=t.changedTouches[0].pageX,t.pageY=t.changedTouches[0].pageY):(t.pageX=t.touches[0].pageX,t.pageY=t.touches[0].pageY)),t},this.getMoved=function(t,e){var n=this.state.begin,o=n.left,i=n.top;return o=t-o,i=e-i,o+=this.state.end.left||0,i+=this.state.end.top||0,this.state.move={left:o,top:i},this.state.move},this.begin=function(t){r.state.begin||(t=r.warpEvent(t),r.setBegin(t.pageX,t.pageY),r.dispatchEvent("begin"))},this.move=function(t){if(r.state.begin){t=r.warpEvent(t);var e=r.getMoved(t.pageX,t.pageY),n=e.left,o=e.top;i.style.left=n+"px",i.style.top=o+"px"}},this.end=function(t){if(r.state.begin){t=r.warpEvent(t);var e=r.getMoved(t.pageX,t.pageY),n=e.left,o=e.top;r.state.begin=!1,r.state.end={left:n,top:o},r.dispatchEvent("end",{left:n,top:o})}},this.moveTo=function(t){var e=t.left,n=t.top;return i.style.left=e+"px",i.style.top=n+"px",r.state.end={left:e,top:n},r},this.start=function(){return t.addEventListener("mousedown",this.begin),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.end),t.addEventListener("touchstart",this.begin),document.addEventListener("touchmove",this.move),document.addEventListener("touchend",this.end),this},this.stop=function(){return t.removeEventListener("mousedown",this.begin),document.removeEventListener("mousemove",this.move),document.removeEventListener("mouseup",this.end),t.removeEventListener("touchstart",this.begin),document.removeEventListener("touchmove",this.move),document.removeEventListener("touchend",this.end),this}};document.body||document.documentElement;function H(o){var i=document.createElement("div");i.className="painter-menu";var n=o.offset();i.style.top=n.top+"px",i.style.left=n.left+"px",document.body.appendChild(i),this.addButton=function(t,e){if(t&&e){var n=document.createElement("div");return n.className="painter-menu__btn",n.innerText=t,n.addEventListener("click",e),i.appendChild(n),n}},this.addPens=function(t){var n=this;return(t=t||w.keys()).forEach(function(t){if(t){t.html||(t={html:t,key:t});var e=document.createElement("div");e.className="painter-menu__btn painter-menu__pen",e.innerHTML=t.html.replace(/pen$/i,""),e.addEventListener("click",function(){e.className+=" active",o.setPen(t.key),n.addPens.prev&&(n.addPens.prev.className=n.addPens.prev.className.replace(" active","")),n.addPens.prev=e}),i.appendChild(e),n.addPens.prev||((n.addPens.prev=e).className+=" active")}}),this},this.moveable=function(){var t=document.createElement("div");t.className="painter-menu__move";var e=new z(t,i).moveTo(n).start();return e.addEventListener("begin",function(){o.disable()}),e.addEventListener("end",function(){o.enable()}),i.appendChild(t),this},this.undo=function(){return this.addButton("撤销",function(){o.undo()}),this.addButton("重做",function(){o.redo()}),this},this.scale=function(){var t=1;return this.addButton("放大",function(){t*=1.1,o.scale(t)}),this.addButton("缩小",function(){t/=1.1,o.scale(t)}),this},this.color=function(t){var n=this;return(t=t||[["red","红色"],["yellow","黄色"],["blue","蓝色"]]).forEach(function(t){var e=n.addButton(t[1],function(){o.setColor(t[0]),e.className+=" active",n.color.prev&&(n.color.prev.className=n.color.prev.className.replace(" active","")),n.color.prev=e});e.style.color=t[0],n.color.prev||((n.color.prev=e).className+=" active")}),this},this.clear=function(){return this.addButton("清空",function(){o.parse([])}),this},this.restore=function(t){return this.restore.count++,this.addButton("恢复"+this.restore.count,function(){o.parse(t)}),this},this.restore.count=0,this.save=function(){var t=this;return this.addButton("保存",function(){t.restore(o.stringify()),o.parse([])}),this},this.disable=function(){return document.body.removeChild(i),this},this.enable=function(){return document.body.appendChild(i),this}}n.d(e,"Drawer",function(){return I}),n.d(e,"DrawerSvg",function(){return D}),n.d(e,"DrawerCanvas",function(){return Y}),n.d(e,"Menu",function(){return H}),n.d(e,"pens",function(){return w});var I=D}],i.c=o,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4);function i(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var n,o});