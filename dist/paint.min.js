!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("paint",[],e):"object"==typeof exports?exports.paint=e():t.paint=e()}(window,function(){return i={},o.m=n=[function(t,e,n){var i=n(1);"string"==typeof i&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};n(3)(i,o);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(2)(!1)).push([t.i,"/**\n * Created Date: 2017-10-16 09:27:09\n * Author: inu1255\n * E-Mail: 929909260@qq.com\n */\n.input-style {\n  width: 100%;\n  height: 38px;\n  padding: 6px 12px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  border-radius: 3px;\n  -webkit-transition: all 0.5s;\n  -o-transition: all 0.5s;\n  transition: all 0.5s;\n}\n.input-style:focus {\n  border-color: #1F90E6;\n  -webkit-box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n          box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n}\n.textarea-style {\n  line-height: 1.42857143;\n  width: 100%;\n  padding: 6px 12px;\n  border-radius: 3px;\n  -webkit-transition: all 0.5s;\n  -o-transition: all 0.5s;\n  transition: all 0.5s;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n}\n.textarea-style:focus {\n  border-color: #1F90E6;\n  -webkit-box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n          box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n}\n.select-style {\n  width: 100%;\n  height: 33px;\n  padding: 5px 12px;\n  background-color: #fff;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  border-radius: 3px;\n  -webkit-transition: all 0.5s;\n  -o-transition: all 0.5s;\n  transition: all 0.5s;\n}\n.select-style:focus {\n  border-color: #1F90E6;\n  -webkit-box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n          box-shadow: 0 0 8px rgba(102, 175, 233, 0.6);\n}\n.hide {\n  opacity: 0;\n  pointer-events: none;\n}\n.show {\n  opacity: 1;\n  pointer-events: auto;\n}\n.painter-menu {\n  position: absolute;\n  background: #eee;\n  border: 1px solid #ccc;\n  max-width: 50%;\n}\n.painter-menu > .painter-menu__btn {\n  float: left;\n  margin: 5px 7px;\n  padding: 2px 5px;\n  color: #fff;\n  background: #1DA57A;\n  cursor: pointer;\n}\n.painter-menu > .painter-menu__btn:hover {\n  background: #048c61;\n}\n.painter-menu > .painter-menu__btn.selected {\n  background: #048c61;\n}\n.painter-menu > .painter-menu__btn:active,\n.painter-menu > .painter-menu__btn.active {\n  background: #007348;\n  -webkit-box-shadow: inset 0 0 20px 0 rgba(0, 0, 0, 0.1), 0 1px 0 rgba(0, 0, 0, 0.2);\n          box-shadow: inset 0 0 20px 0 rgba(0, 0, 0, 0.1), 0 1px 0 rgba(0, 0, 0, 0.2);\n}\n.painter-menu > .painter-menu__btn:disabled {\n  background: #36be93;\n  opacity: 0.65;\n  cursor: not-allowed;\n}\n.painter-menu > .painter-menu__move {\n  margin: 5px 7px;\n  width: 24px;\n  height: 24px;\n  float: right;\n  border: 1px solid #ccc;\n  cursor: move;\n}\n.painter-canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n.painter-canvas > * {\n  pointer-events: none;\n}\n.painter-canvas.eraser > * {\n  pointer-events: visiblestroke;\n}\n.painter-canvas.disable {\n  pointer-events: none;\n}\n.painter-canvas.disable > * {\n  pointer-events: none;\n}\n.painter-canvas__item {\n  position: absolute;\n}\n",""])},function(t,e,n){"use strict";t.exports=function(n){var s=[];return s.toString=function(){return this.map(function(t){var e=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o=function(t){var e=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(n," */")}(i),r=i.sources.map(function(t){return"/*# sourceURL=".concat(i.sourceRoot).concat(t," */")});return[n].concat(r).concat([o]).join("\n")}return[n].join("\n")}(t,n);return t[2]?"@media ".concat(t[2],"{").concat(e,"}"):e}).join("")},s.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(n[o]=!0)}for(var r=0;r<t.length;r++){var a=t[r];null!=a[0]&&n[a[0]]||(e&&!a[2]?a[2]=e:e&&(a[2]="(".concat(a[2],") and (").concat(e,")")),s.push(a))}},s}},function(t,e,o){"use strict";var n,i,l={},r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},a=(i={},function(t){if(void 0===i[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}i[t]=e}return i[t]});function f(t,e){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=e.base?r[0]+e.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function h(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=l[i.id],r=0;if(o){for(o.refs++;r<o.parts.length;r++)o.parts[r](i.parts[r]);for(;r<i.parts.length;r++)o.parts.push(y(i.parts[r],e))}else{for(var a=[];r<i.parts.length;r++)a.push(y(i.parts[r],e));l[i.id]={id:i.id,refs:1,parts:a}}}}function s(e){var n=document.createElement("style");if(void 0===e.attributes.nonce){var t=o.nc;t&&(e.attributes.nonce=t)}if(Object.keys(e.attributes).forEach(function(t){n.setAttribute(t,e.attributes[t])}),"function"==typeof e.insert)e.insert(n);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}return n}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function p(t,e,n,i){var o=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}var d=null,v=0;function y(e,t){var n,i,o;if(t.singleton){var r=v++;n=d=d||s(t),i=p.bind(null,n,r,!1),o=p.bind(null,n,r,!0)}else n=s(t),i=function(t,e,n){var i=n.css,o=n.media,r=n.sourceMap;if(o&&t.setAttribute("media",o),r&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,n,t),o=function(){!function(t){if(null===t.parentNode)return;t.parentNode.removeChild(t)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}t.exports=function(t,c){(c=c||{}).attributes="object"==typeof c.attributes?c.attributes:{},c.singleton||"boolean"==typeof c.singleton||(c.singleton=r());var u=f(t,c);return h(u,c),function(t){for(var e=[],n=0;n<u.length;n++){var i=u[n],o=l[i.id];o&&(o.refs--,e.push(o))}t&&h(f(t,c),c);for(var r=0;r<e.length;r++){var a=e[r];if(0===a.refs){for(var s=0;s<a.parts.length;s++)a.parts[s]();delete l[a.id]}}}}},function(t,e,n){"use strict";n.r(e);n(0);var y=function(){var r={};this.addEventListener=function(t,e){return void 0===r[t]&&(r[t]=[]),"function"==typeof e&&r[t].push(e),this},this.dispatchEvent=function(t,e){var n=r[t];if(n instanceof Array)for(var i=0,o=n.length;i<o;i+=1)"function"==typeof n[i]&&n[i](e);return this},this.removeEventListener=function(t,e){var n=r[t];if("string"==typeof t&&n instanceof Array)if("function"==typeof e){for(var i=0,o=n.length;i<o;i+=1)if(n[i]===e){r[t].splice(i,1);break}}else void 0===e&&delete r[t];return this}};function i(o,r){var a=[];this.begin=function(t,e){a.push(t),a.push(e)},this.move=function(t,e,n,i){a.push(n),a.push(i),o(a)},this.end=function(t,e,n,i){a.push(n),a.push(i),r(a)}}i.moveBegin=!0,i.outEnd=!0,i.render=function(t,e){if(t instanceof Array&&0<t.length){var n=e.ctx;n.beginPath(),n.moveTo(t[0],t[1]);for(var i=2;i<t.length;i+=2)n.lineTo(t[i],t[i+1]);n.stroke()}},i.renderSvg=function(t,e){if(t instanceof Array&&0<t.length){for(var n="",i=0;i<t.length;i++){i%2==0&&(n+=0==i?"M":"L"),n+=t[i]+" "}return'<path d="'.concat(n,'" style="').concat(e.getStyle(),'"/>')}};var o=i;function r(o,r){this.move=function(t,e,n,i){o([t,e,n,i])},this.end=function(t,e,n,i){r([t,e,n,i])}}r.moveBegin=!0,r.render=function(t,e){if(t&&4===t.length){var n=e.ctx;n.beginPath(),n.moveTo(t[0],t[1]),n.lineTo(t[2],t[3]),n.stroke()}},r.renderSvg=function(t,e){return t&&4===t.length?'<line x1="'.concat(t[0],'" y1="').concat(t[1],'" x2="').concat(t[2],'" y2="').concat(t[3],'" style="').concat(e.getStyle(),'"/>'):""};var a=r;function s(o,r){this.move=function(t,e,n,i){o([t,e,n,i])},this.end=function(t,e,n,i){r([t,e,n,i])}}s.moveBegin=!0,s.render=function(t,e){if(t&&4===t.length){var n=e.ctx,i=(t[0]+t[2])/2,o=(t[1]+t[3])/2,r=(t[2]-t[0])/2,a=(t[3]-t[1])/2,s=a<r?r:a,c=r/s,u=a/s;n.scale(c,u),n.beginPath(),n.arc(i/c,o/u,s,0,2*Math.PI,!1),n.closePath(),n.stroke()}},s.renderSvg=function(t,e){if(t&&4===t.length){var n=(t[0]+t[2])/2,i=(t[1]+t[3])/2,o=Math.abs((t[2]-t[0])/2),r=Math.abs((t[3]-t[1])/2);return'<ellipse cx="'.concat(n,'" cy="').concat(i,'" rx="').concat(o,'" ry="').concat(r,'" style="').concat(e.getStyle(),'"/>')}return""};var c=s;function u(o,r){this.move=function(t,e,n,i){o([t,e,n,i])},this.end=function(t,e,n,i){r([t,e,n,i])}}u.moveBegin=!0,u.render=function(t,e){if(t&&4===t.length){var n=e.ctx;n.beginPath(),n.moveTo(t[0],t[1]),n.lineTo(t[2],t[1]),n.lineTo(t[2],t[3]),n.lineTo(t[0],t[3]),n.lineTo(t[0],t[1]),n.stroke()}},u.renderSvg=function(t,e){if(t&&4===t.length){var n=Math.min(t[0],t[2]),i=Math.min(t[1],t[3]),o=Math.abs(t[2]-t[0]),r=Math.abs(t[3]-t[1]);return'<rect x="'.concat(n,'" y="').concat(i,'" width="').concat(o,'" height="').concat(r,'" style="').concat(e.getStyle(),'"/>')}};var l=u;function f(r,t,a){var s,c,u;this.close=this.begin=function(){if(u&&(t(u),u=null),c)try{c.removeChild(s)}catch(t){}},this.end=function(t,e,n,i){var o=this;u=[t,e],(s=document.createElement("textarea")).addEventListener("keyup",function(t){t.ctrlKey&&13==t.keyCode?o.close():(u[2]=s.value,r(u))}),c=a(s,n,i),s.focus()}}f.render=function(t,e){if(t&&4<=t.length){var n=e.ctx;n.font=f.font;var i=t[2]||"",o=t[0],r=t[1],a=parseInt(f.font);i.split("\n").forEach(function(t,e){n.fillText(t,o,r+e*a)})}},f.renderSvg=function(t,e){if(t&&3===t.length){var n=t[0],i=t[1],o=parseInt(e.penStyle["font-size"]),r="",a=!0,s=!1,c=void 0;try{for(var u,l=(t[2]||"").split("\n")[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var f=u.value;r+='<text x="'.concat(n,'" y="').concat(i,'" style="').concat(e.getStyle(),'">').concat(f,"</text>"),i+=o}}catch(t){s=!0,c=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}return"<g>".concat(r,"</g>")}return""};var h=f;function p(t,e){return e=e||0,t.previousElementSibling?p(t.previousElementSibling,e+1):e+""}function d(o,r,t,e){if("svg"==e.canvas.tagName){var a=[],n=function(t){t.target!=e.canvas&&1==t.which&&(a.push(p(t.target)),o(a))},i=function(t){t.target!=e.canvas&&(a.push(p(t.target)),o(a))};e.canvas.addEventListener("mousemove",n),e.canvas.addEventListener("click",i),this.end=function(t,e,n,i,o){r(0<a.length?a:void 0)},this.unmount=function(){e.canvas.removeEventListener("mousemove",n),e.canvas.removeEventListener("click",i)}}else{var s=[];this.begin=function(t,e,n,i){s.push(t),s.push(e)},this.move=function(t,e,n,i){s.push(n),s.push(i),o(s)},this.end=function(t,e,n,i){s.push(n),s.push(i),r(s)}}}function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}d.render=function(t,e){if(t instanceof Array&&0<t.length)for(var n=e.ctx,i=0;i<t.length;i+=2)n.save(),n.beginPath(),n.arc(t[i],t[i+1],5,0,2*Math.PI),n.clip(),n.clearRect(0,0,n.canvas.width,n.canvas.height),n.restore()},d.renderSvg=function(t,n){t instanceof Array&&0<t.length&&t.forEach(function(t){var e=n.canvas.childNodes[t];e&&(e.style.display="none")})};var g={defaultPen:o,linePen:a,ellipsePen:c,rectPen:l,textPen:h,eraser:d};var m={get:function(t){return g[t]||o},key:function(t){if("object"==v(t)&&(t=t.constuctor),"function"==typeof t&&"function"==typeof t.render)for(var e in g){if(t==g[e])return e}},set:function(t,e){return"function"==typeof e&&"function"==typeof e.render&&(g[t]=e,!0)},keys:function(){var t=[];for(var e in g)t.push(e);return t}};var b=function(t){var e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset-document.documentElement.clientTop,left:e.left+window.pageXOffset-document.documentElement.clientLeft,right:e.right,bottom:e.bottom}};function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=m.get();Object.assign||(Object.assign=function(t,e){for(var n in e){var i=e[n];t[n]=i}return t});var E=function(){function v(t,i){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,v),y.call(this);var e,r=this.canvas=this.createCanvas(),a=this.dom=t;t instanceof HTMLImageElement&&(a=document.createElement("div"),Object.assign(a.style,t.style),t.parentElement.insertBefore(a,t),t.parentElement.removeChild(t),a.appendChild(t)),i=this.config=Object.assign(this.defaultConfig(),i),this.init();var s=!1;function c(){return e}this.outPoint=!1,this.setData=function(t){void 0!==t&&(o.config.penData=t,o.update())};function n(t){var e=o.normalizeEvent(t,i),n=c();s=s||{x:e.offsetX,y:e.offsetY},"function"==typeof n.begin&&n.begin(s.x,s.y),t.preventDefault()}function u(t){var e=o.normalizeEvent(t,i),n=c();!s&&1==t.which&&i.penClass.moveBegin&&(s={x:e.offsetX,y:e.offsetY,moveBegin:!0}),s&&("function"==typeof n.move&&n.move(s.x,s.y,e.offsetX,e.offsetY),t.preventDefault&&t.preventDefault())}function l(t){var e=o.normalizeEvent(t,i);f({x:e.offsetX,y:e.offsetY}),t.preventDefault()}var f=this.end=function(t,e){var n;"setPen"==e&&"function"==typeof(n=c()).close&&n.close();s&&("function"==typeof(n=c()).end&&n.end(s.x,s.y,t.x,t.y,e),s=!1)};r.addEventListener("mousedown",n),r.addEventListener("mousemove",u),r.addEventListener("mouseup",l),r.addEventListener("touchstart",n),r.addEventListener("touchmove",u),r.addEventListener("touchend",l),r.addEventListener("mouseover",function(t){i.penClass.outEnd||o.outPoint&&1!=t.which&&f(o.outPoint,"mouseover"),o.outPoint=!1}),r.addEventListener("mouseout",function(t){var e=o.normalizeEvent(t,i);o.outPoint={x:e.offsetX,y:e.offsetY},t.toElement&&t.toElement.parentElement==r||(i.penClass.outEnd?f(o.outPoint,"mouseout"):1==t.which&&u(e))});function h(t,e,n){return t&&(t.className="painter-canvas__item",null!=e&&(t.style.left=o.warpData(e,r)+"px"),null!=n&&(t.style.top=o.warpData(n,r,1)+"px"),a.appendChild(t)),a}var p=this.createNewPen=function(){e&&"function"==typeof e.unmount&&e.unmount(),e=new i.penClass(o.setData,d,h,o)},d=function(t){o.dispatchEvent("success",t),p(),void 0!==t&&(i.history.push({key:m.key(i.penClass),data:t,style:o.getStyle()}),i.penData=void 0,i.redo.length=0,o.update())};p(),a.appendChild(r),"static"===getComputedStyle(a).position&&(a.style.position="relative"),this.resize()}return function(t,e,n){e&&x(t.prototype,e),n&&x(t,n)}(v,[{key:"defaultConfig",value:function(){return{history:[],redo:[],penClass:w}}},{key:"warpData",value:function(t,e){var n=this.config;if(t instanceof Array){var i=[];for(e=0;e<t.length;e++){var o=t[e];i.push(this.warpData(o,e))}return i}return"number"==typeof t?(1&e?n.height:n.width)*t/1e4:t}},{key:"normalizeEvent",value:function(t,e){if(t.normalized)return t;var n,i;if(t instanceof TouchEvent){var o=b(t.target);n=(t.changedTouches[0]||t.touches[0]).pageX-o.left,i=(t.changedTouches[0]||t.touches[0]).pageY-o.top}else n=t.offsetX,i=t.offsetY;return{offsetX:n=Math.floor(n/e.width*1e4),offsetY:i=Math.floor(i/e.height*1e4),normalized:!0}}},{key:"setPen",value:function(t){this.end(this.outPoint,"setPen"),"string"==typeof t&&(this._prevPenClass&&this.canvas.classList.remove(this._prevPenClass),this._prevPenClass=t,this.canvas.classList.add(t)),void 0===t&&(t=w);var e=m.get(t);e?(this.config.penClass!=e&&(this.config.penClass=e,this.config.penData=void 0),this.createNewPen()):console.log("不能识别的画笔",t)}},{key:"stringify",value:function(){return JSON.stringify(this.config.history)}},{key:"parse",value:function(t){if("string"==typeof t)this.config.history=JSON.parse(t);else{if(!(t instanceof Array))return;this.config.history=t}this.update(!0)}},{key:"undo",value:function(t){if(0<this.config.history.length){if(t)return!0;this.config.redo.push(this.config.history.pop()),this.update(!0)}}},{key:"redo",value:function(t){if(0<this.config.redo.length){if(t)return!0;this.config.history.push(this.config.redo.pop()),this.update()}}},{key:"getCanvas",value:function(){return this.canvas}},{key:"resize",value:function(){var t=!1,e=this.dom,n=this.config;return e.offsetWidth!=n.width&&(t=!0,n.width=e.scrollWidth||e.offsetWidth),e.offsetHeight!=n.height&&(t=!0,n.height=e.scrollHeight||e.offsetHeight),t}},{key:"offset",value:function(){return b(this.canvas)}},{key:"disable",value:function(){this.canvas.classList.add("disable")}},{key:"enable",value:function(){this.canvas.classList.remove("disable")}},{key:"scale",value:function(t){this.canvas.parentElement.style.transformOrigin="50% 0 0",this.canvas.parentElement.style.transform="scale(".concat(t,")"),this.update()}},{key:"init",value:function(){}},{key:"createCanvas",value:function(){}},{key:"getStyle",value:function(){}},{key:"update",value:function(){}}]),v}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function C(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var L=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),C(this,_(t).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(t,E),function(t,e,n){e&&k(t.prototype,e),n&&k(t,n)}(t,[{key:"createCanvas",value:function(){var t=document.createElement("div");return t.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="painter-canvas"></svg>',t.childNodes[0]}},{key:"init",value:function(){this.current_indx=0,this.penStyle={fill:"rgba(0,0,0,0)",stroke:"red","font-size":"30px","stroke-width":2,"letter-spacing":"0px"}}},{key:"getStyle",value:function(){var t="";for(var e in this.penStyle){t+=e+":"+this.penStyle[e]+";"}return t}},{key:"setColor",value:function(t){return this.penStyle.stroke=t}},{key:"setStyle",value:function(t){var n=this;"object"===S(t)?Object.assign(this.penStyle,t):"string"==typeof t&&t.split(";").forEach(function(t){var e=t.split(":");1<e.length&&(n.penStyle[e[0].trim()]=e[1].trim())})}},{key:"append",value:function(t,e){if(e){var i;try{i=document.createElementNS("http://www.w3.org/2000/svg",/<(\w+)/.exec(e)[1]),e.replace(/\s+(\w+)=['"]([^'"]+)['"]/g,function(t,e,n){i.setAttribute(e,n)}),e.replace(/>([\s\S]+)</,function(t,e){i.innerHTML=e}),this.currentDom?t.insertBefore(i,this.currentDom):t.appendChild(i)}catch(t){console.log(t)}return i}}},{key:"update",value:function(t){this.resize();var e=this.canvas,n=this.config;if(this.dispatchEvent("beforeupdate"),t){for(this.current_indx=0;e.hasChildNodes();)e.removeChild(e.firstChild);this.currentDom=!1}if(void 0!==n.penData){var i=n.penClass.renderSvg(this.warpData(n.penData),this);this.currentDom&&(e.removeChild(this.currentDom),this.currentDom=!1),this.currentDom=this.append(e,i)}else this.currentDom&&(e.removeChild(this.currentDom),this.currentDom=!1);for(;this.current_indx<n.history.length;this.current_indx++){var o=n.history[this.current_indx];this.append(e,this.paintItem(o,this.current_indx))}this.dispatchEvent("update")}},{key:"resize",value:function(){var t=!1,e=this.canvas,n=this.config,i=this.dom;return i.offsetWidth!=e.width&&(t=!0,n.width=i.scrollWidth||i.offsetWidth,e.style.width=n.width+"px"),i.offsetHeight!=e.height&&(t=!0,n.height=i.scrollHeight||i.offsetHeight,e.style.height=n.height+"px"),t}},{key:"paintItem",value:function(t){if("object"==S(t)){var e=m.get(t.key),n="";if(e&&e.renderSvg){var i=this.getStyle();this.setStyle(t.style),n=e.renderSvg(this.warpData(t.data),this),this.setStyle(i)}return n}}},{key:"toSvg",value:function(){var t=this.canvas.cloneNode();t.innerHTML=this.canvas.innerHTML;for(var e=t.childNodes.length-1;0<=e;e--){var n=t.childNodes[e];"none"===n.style.display&&t.removeChild(n)}return t.removeAttribute("class"),t.removeAttribute("style"),t.outerHTML}}]),t}();function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function j(t,e){return!e||"object"!==N(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function D(t,e,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=T(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var B=["fillStyle","filter","font","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","imageSmoothingQuality","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"];CanvasRenderingContext2D.prototype.getStyle=function(){var e=this,n={};return B.forEach(function(t){e[t]!=e.initStyle[t]&&(n[t]=e[t])}),n},CanvasRenderingContext2D.prototype.setStyle=function(e){var n=this;return"object"!=N(e)||B.forEach(function(t){null!=e[t]?n[t]=e[t]:n.initStyle[t]&&(n[t]=n.initStyle[t])}),this};var A=function(){function n(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),j(this,T(n).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(n,E),function(t,e,n){e&&O(t.prototype,e),n&&O(t,n)}(n,[{key:"defaultConfig",value:function(){return Object.assign({background:"",initStyle:{fillStyle:"red",strokeStyle:"red"}},D(T(n.prototype),"defaultConfig",this).call(this))}},{key:"init",value:function(){var t=this.ctx=this.canvas.getContext("2d");t.initStyle={},t.setStyle(this.config.initStyle),t.initStyle=t.getStyle()}},{key:"createCanvas",value:function(){var t=document.createElement("canvas");return t.className="painter-canvas",t}},{key:"getStyle",value:function(){return this.ctx.getStyle()}},{key:"update",value:function(){var e=this;this.resize();var t=this.canvas,n=this.ctx,i=this.config;n.clearRect(0,0,i.width,i.height),this.dispatchEvent("beforeupdate",n),i.background&&n.drawImage(i.background,0,0,i.width,i.height),i.history.forEach(function(t){e.paintItem(n,t,i)}),void 0!==i.penData&&(n.save(),i.penClass.render(this.warpData(i.penData,t),this),n.restore()),this.dispatchEvent("update",n)}},{key:"resize",value:function(){if(D(T(n.prototype),"resize",this).call(this)){var t=this.canvas,e=this.config;t.width=e.width,t.height=e.height,this.ctx.setStyle({})}}},{key:"paintItem",value:function(t,e){if("object"==N(e)){var n=m.get(e.key);n&&(t.save(),t.setStyle(e.style),n.render(this.warpData(e.data),this),t.restore())}}},{key:"getCtx",value:function(){return this.ctx}},{key:"setColor",value:function(t){this.ctx.fillStyle=t,this.ctx.strokeStyle=t}},{key:"toDataURL",value:function(){return this.canvas.toDataURL()}}]),n}();var R=function(t,o){var r=this;y.call(this),o=o||t,this.state={end:b(o)},this.setBegin=function(t,e){this.state.begin={left:t,top:e}},this.warpEvent=function(t){return t.preventDefault(),t instanceof TouchEvent&&("touchend"===t.type?(t.pageX=t.changedTouches[0].pageX,t.pageY=t.changedTouches[0].pageY):(t.pageX=t.touches[0].pageX,t.pageY=t.touches[0].pageY)),t},this.getMoved=function(t,e){var n=this.state.begin,i=n.left,o=n.top;return i=t-i,o=e-o,i+=this.state.end.left||0,o+=this.state.end.top||0,this.state.move={left:i,top:o},this.state.move},this.begin=function(t){r.state.begin||(t=r.warpEvent(t),r.setBegin(t.pageX,t.pageY),r.dispatchEvent("begin"))},this.move=function(t){if(r.state.begin){t=r.warpEvent(t);var e=r.getMoved(t.pageX,t.pageY),n=e.left,i=e.top;o.style.left=n+"px",o.style.top=i+"px"}},this.end=function(t){if(r.state.begin){t=r.warpEvent(t);var e=r.getMoved(t.pageX,t.pageY),n=e.left,i=e.top;r.state.begin=!1,r.state.end={left:n,top:i},r.dispatchEvent("end",{left:n,top:i})}},this.moveTo=function(t){var e=t.left,n=t.top;return o.style.left=e+"px",o.style.top=n+"px",r.state.end={left:e,top:n},r},this.start=function(){return t.addEventListener("mousedown",this.begin),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.end),t.addEventListener("touchstart",this.begin),document.addEventListener("touchmove",this.move),document.addEventListener("touchend",this.end),this},this.stop=function(){return t.removeEventListener("mousedown",this.begin),document.removeEventListener("mousemove",this.move),document.removeEventListener("mouseup",this.end),t.removeEventListener("touchstart",this.begin),document.removeEventListener("touchmove",this.move),document.removeEventListener("touchend",this.end),this}};document.body||document.documentElement;function X(i){var o=document.createElement("div");o.className="painter-menu";var n=i.offset();o.style.top=n.top+"px",o.style.left=n.left+"px",document.body.appendChild(o),this.addButton=function(t,e){if(t&&e){var n=document.createElement("div");return n.className="painter-menu__btn",n.innerText=t,n.addEventListener("click",e),o.appendChild(n),n}},this.addPens=function(t){var n=this;return(t=t||m.keys()).forEach(function(t){if(t){t.html||(t={html:t,key:t});var e=document.createElement("div");e.className="painter-menu__btn painter-menu__pen",e.innerHTML=t.html.replace(/pen$/i,""),e.addEventListener("click",function(){e.className+=" active",i.setPen(t.key),n.addPens.prev&&(n.addPens.prev.className=n.addPens.prev.className.replace(" active","")),n.addPens.prev=e}),o.appendChild(e),n.addPens.prev||((n.addPens.prev=e).className+=" active")}}),this},this.moveable=function(){var t=document.createElement("div");t.className="painter-menu__move";var e=new R(t,o).moveTo(n).start();return e.addEventListener("begin",function(){i.disable()}),e.addEventListener("end",function(){i.enable()}),o.appendChild(t),this},this.undo=function(){return this.addButton("撤销",function(){i.undo()}),this.addButton("重做",function(){i.redo()}),this},this.scale=function(){var t=1;return this.addButton("放大",function(){t*=1.1,i.scale(t)}),this.addButton("缩小",function(){t/=1.1,i.scale(t)}),this},this.color=function(t){var n=this;return(t=t||[["red","红色"],["yellow","黄色"],["blue","蓝色"]]).forEach(function(t){var e=n.addButton(t[1],function(){i.setColor(t[0]),e.className+=" active",n.color.prev&&(n.color.prev.className=n.color.prev.className.replace(" active","")),n.color.prev=e});e.style.color=t[0],n.color.prev||((n.color.prev=e).className+=" active")}),this},this.clear=function(){return this.addButton("清空",function(){i.parse([])}),this},this.restore=function(t){return this.restore.count++,this.addButton("恢复"+this.restore.count,function(){i.parse(t)}),this},this.restore.count=0,this.save=function(){var t=this;return this.addButton("保存",function(){t.restore(i.stringify()),i.parse([])}),this},this.disable=function(){return document.body.removeChild(o),this},this.enable=function(){return document.body.appendChild(o),this}}n.d(e,"Drawer",function(){return Y}),n.d(e,"DrawerSvg",function(){return L}),n.d(e,"DrawerCanvas",function(){return A}),n.d(e,"Menu",function(){return X}),n.d(e,"pens",function(){return m});var Y=L}],o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=4);function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}var n,i});